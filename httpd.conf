# ServerRoot "/usr/local/apache2"
# PidFile "/usr/local/apache2/logs/httpd.pid"

# # MPM 모듈 로드 (예: event MPM)
# LoadModule mpm_event_module modules/mod_mpm_event.so
# LoadModule ssl_module modules/mod_ssl.so
# # 기본 모듈 로드
# LoadModule unixd_module modules/mod_unixd.so
# LoadModule authz_core_module modules/mod_authz_core.so
# LoadModule dir_module modules/mod_dir.so

# # 리버스 프록시에 필요한 모듈
# LoadModule proxy_module modules/mod_proxy.so
# LoadModule proxy_http_module modules/mod_proxy_http.so
# LoadModule proxy_wstunnel_module modules/mod_proxy_wstunnel.so

# # 서버 기본 리스닝 포트
# Listen 80

# ServerName localhost

# ErrorLog "/usr/local/apache2/logs/error.log"
# LogLevel warn

# DocumentRoot "/usr/local/apache2/htdocs"
# <Directory "/usr/local/apache2/htdocs">
#     AllowOverride None
#     Require all granted
# </Directory>

# <VirtualHost *:80>
#     ProxyPreserveHost On
#     ServerName localhost
#     SSLProxyEngine On
#     SSLProxyVerify none
#     SSLProxyCheckPeerCN off
#     SSLProxyCheckPeerName off
#     SSLProxyCheckPeerExpire off

#     # 백엔드 API 프록시 설정 (예: /api, /login 등)
#     # ProxyPass "/api" "https://backend:8000/api"
#     # ProxyPassReverse "/api" "https://backend:8000/api"
#     ProxyPass "/api" "https://172.31.240.92:8000/api"
#     ProxyPassReverse "/api" "https://172.31.240.92:8000/api"
#     ProxyPass "/login" "https://backend:8000/login"
#     ProxyPassReverse "/login" "https://backend:8000/login"
    
#     # 프론트엔드 프록시 (나머지 요청)
#     ProxyPass "/" "http://frontend:3000/"
#     ProxyPassReverse "/" "http://frontend:3000/"
# </VirtualHost>
ServerRoot "/usr/local/apache2"
PidFile "/usr/local/apache2/logs/httpd.pid"

# MPM 및 SSL 모듈 로드
LoadModule mpm_event_module modules/mod_mpm_event.so
LoadModule ssl_module modules/mod_ssl.so

# 기본 모듈 로드
LoadModule unixd_module modules/mod_unixd.so
LoadModule authz_core_module modules/mod_authz_core.so
LoadModule dir_module modules/mod_dir.so

# 리버스 프록시 관련 모듈 로드
LoadModule proxy_module modules/mod_proxy.so
LoadModule proxy_http_module modules/mod_proxy_http.so
LoadModule proxy_wstunnel_module modules/mod_proxy_wstunnel.so

# 서버 기본 리스닝 포트
Listen 80

ServerName localhost

ErrorLog "/usr/local/apache2/logs/error.log"
LogLevel warn

DocumentRoot "/usr/local/apache2/htdocs"
<Directory "/usr/local/apache2/htdocs">
    AllowOverride None
    Require all granted
</Directory>

<VirtualHost *:80>
    ProxyPreserveHost On
    ServerName localhost

    # SSL 프록시 설정 (백엔드가 HTTPS로 동작하므로)
    SSLProxyEngine On
    SSLProxyVerify none
    SSLProxyCheckPeerCN off
    SSLProxyCheckPeerName off
    SSLProxyCheckPeerExpire off

    # 백엔드 API 프록시 설정
    ProxyPass "/api" "https://backend:8000/api"
    ProxyPassReverse "/api" "https://backend:8000/api"
    ProxyPass "/login" "https://backend:8000/login"
    ProxyPassReverse "/login" "https://backend:8000/login"
    ProxyPass "/db" "https://backend:8000/db"
    ProxyPassReverse "/db" "https://backend:8000/db"
    
    # 프론트엔드 프록시 (나머지 모든 요청)
    ProxyPass "/" "http://frontend:3000/"
    ProxyPassReverse "/" "http://frontend:3000/"
</VirtualHost>
